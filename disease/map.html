<html>
  <head>
    <title>Disease Map</title>
    
    <script src="/static/scripts/jquery-1.6.1.min.js"></script>
    <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
    
    <link type="text/css" href="/static/css/ui-lightness/jquery-ui-1.8.13.custom.css" rel="Stylesheet" />  
    <script type="text/javascript" src="/static/scripts/jquery-ui-1.8.13.custom.min.js"></script>
    
  <script>
    (function(){
      function hello(){
        alert("hello");
      }

      var map = null;
      var layer = null;
      var fusionTableId = 949030;
      var defaultLat = 32.9352;
      var defaultLon = -118.3887;
      
      function showMap(){
       
       var latlng = new google.maps.LatLng(defaultLat, defaultLon);
        
        var myOptions = {
          zoom: 4,
          center: latlng,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        
        var map = new google.maps.Map(document.getElementById("map"), myOptions);
        
        layer = new google.maps.FusionTablesLayer(fusionTableId, { suppressInfoWindows: true });
        layer.setMap(map);
        updateMap(1);
      }

      function updateMap(diseaseId, startDate, endDate){
        var query = "select * from " + fusionTableId;
        
        query += " where DiseaseID = " + diseaseId;
        
        if(startDate){
          query += " and DiagnosisTime > " + ((new Date(startDate)).getTime() / 1000);
        }
         if(endDate){
          query += " and DiagnosisTime < " + ((new Date(endDate)).getTime() / 1000);
        }
        alert(query);
        layer.setQuery(query);
      }
     
      $(function(){
      
        hello();
        
        showMap();
        
        function updateSliderMinMax(){
          $("#dateSlider").slider("option", "min");
        }

        function uiChange(){
          var diseaseId = $("#disease").val();
          var startDate = $("#startDate").val();
          var endDate = $("#endDate").val();
          
          updateSliderMinMax();
          updateMap(diseaseId, startDate, endDate);

        }

        $("#disease").change(uiChange);
        $("#startDate").change(uiChange);
        $("#endDate").change(uiChange);
        
        $("#startDate").datepicker();
        $("#endDate").datepicker();
        $("#dateSlider").slider();

        $("#dateSlider").bind("slidechange", function(event, ui) {
          alert(ui.value);
        });
      
      });
    
    })();
    </script>
 
  </head>
  
  <body>
    <table>
      <tr>
        <td><select id="disease"><option value="1">1</option><option value="2">2</option></select></td>
        <td><input id="startDate" type="text" /></td><td><input id="endDate" type="text" /></td>
        <td><div id="dateSlider" style="width:200px"></div></td>
      </tr>
    </table>

    <div id="map" style="width:100%; height:90%"></div>
  
  </body>
</html>
